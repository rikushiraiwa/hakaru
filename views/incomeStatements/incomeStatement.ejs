<% layout('layout/boilerplate') %>

<div class="container my-5">
  <h2 class="text-center mb-5">損益計算書</h2>

  <form action="/incomeStatements/register" method="POST">
    <!-- 一般情報セクション -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-info text-white d-flex align-items-center justify-content-center" style="height: 70px;">
        <h2 class="mb-0">
            <i class="fas fa-info-circle"></i> 一般情報
        </h2>
      </div>
    
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>登録日</th>
                <th>顧客名</th>
                <th>製品名</th>
                <th>製品価格</th>
                <th>注文日</th>
                <th>発送日</th>
                <th>支払い金額</th>
                <th>未収金額</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><input type="date" name="registerDate" class="form-control" required /></td>
                <td><input type="text" name="customerName" class="form-control" required /></td>
                <td>
                  <select name="productName" class="form-select" required>
                    <option value="">製品を選択</option>
                    <% recipes.forEach(function(recipe) { %>
                      <option value="<%= recipe.recipeName %>"><%= recipe.recipeName %></option>
                    <% }) %>
                  </select>
                </td>
                <td><input type="number" name="productPrice" class="form-control" required /></td>
                <td><input type="date" name="orderDate" class="form-control" required /></td>
                <td><input type="date" name="shippingDate" class="form-control" required /></td>
                <td><input type="number" name="payment" class="form-control" required /></td>
                <td><input type="number" name="uncollectedPrice" class="form-control" required /></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 売上詳細セクション (Minne Salesと損益計算書の統合) -->
    <div class="card shadow-sm mb-4">
      <div class="card-header text-white d-flex align-items-center justify-content-center" style="height: 70px; background-color: orange;">
        <h2 class="mb-0">
            <i class="fas fa-chart-line"></i> 売上詳細
        </h2>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <tbody>
              <tr>
                <th>売上高</th>
                <td><input type="number" name="sales" id="sales" class="form-control" oninput="calculateTotals()" /></td>
              </tr>
              <tr>
                <th>売上原価 (COGS)</th>
                <td><input type="number" name="cogs" id="cogs" class="form-control" readonly /></td>
              </tr>
              <tr>
                <th>販売手数料</th>
                <td><input type="number" name="salesCommission" id="salesCommission" class="form-control" oninput="calculateTotals()" /></td>
              </tr>
              <tr>
                <th>振込手数料</th>
                <td><input type="number" name="transferFee" id="transferFee" class="form-control" oninput="calculateTotals()" /></td>
              </tr>
              <tr>
                <th>送料</th>
                <td><input type="number" name="shippingFee" id="shippingFee" class="form-control" oninput="calculateTotals()" /></td>
              </tr>
              <tr>
                <th>営業経費</th>
                <td><input type="text" name="expenses" id="expenses" class="form-control" readonly /></td>
              </tr>
              <tr>
                <th>粗利益</th>
                <td><span id="grossProfit">0.00</span></td>
              </tr>
              <tr>
                <th>純利益</th>
                <td><span id="netProfit">0.00</span></td>
              </tr>
              <tr>
                <th>純利益率</th>
                <td><span id="netRatio">0.00</span> %</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="text-center my-4">
      <button type="submit" class="btn btn-lg btn-primary"><i class="fas fa-check"></i> 登録</button>
    </div>
  </form>
</div>

<!-- RecipesデータをJSON形式で渡す -->
<script id="recipesData" type="application/json">
  <%- JSON.stringify(recipes) %>
</script>
<script src="/js/sold.js"></script>
